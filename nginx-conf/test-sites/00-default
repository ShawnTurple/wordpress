server {
	listen 8080 default_server;
	server_name _;
	return 444;
}

server {
	listen 127.0.0.1:8080;
	server_name localhost 127.0.0.1;
	root /data/www-app/localhost;

	location / {
		return 403;
	}

	location ~ \.php$ {
		include fastcgi_params;

		fastcgi_pass php;
		fastcgi_index index.php;
		fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
	}
}

server {
	server_name $hostname;
	root /data/www-app/localhost;

	location ~ ^/(status|ping)$ {
		access_log off;

		include global/allow-monitoring.conf;
		deny all;

		include fastcgi_params;
		fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
		fastcgi_pass php;
	}

	location /nginx_status {
		stub_status on;
		access_log off;

		include global/allow-monitoring.conf;
		deny all;
	}

	location / {
		return 403;
	}

	### Satis for Wordpress Plugin and Theme Management
	location ^~ /satis {
		alias /data/www-app/satis;
		include global/allow-servers.conf;
		deny all;
	}
	### End Satis

	### GitList for Wordpress Plugin and Theme Repos
	location ^~ /gitlist {
		alias /data/www-app/gitlist;
		try_files $uri $uri/ @gitlist;

		include global/allow-servers.conf;
		deny all;

		location ~ \.php$ {
			include fastcgi_params;

			fastcgi_pass php;
			fastcgi_index index.php;
			fastcgi_param SCRIPT_FILENAME $request_filename;
		}
	}

	location @gitlist {
        rewrite /gitlist/(.*)$ /gitlist/index.php?/$1 last;
    }
    ### End GitList ###

    ### Git http
    location ^~ /git {
		alias /data/git;
		client_max_body_size 0;

		try_files $uri $uri/ =404;
	}
    ### End of Git http ###

	location ~ \.php$ {
		access_log off;

		include global/allow-monitoring.conf;
		deny all;

		include fastcgi_params;

		fastcgi_pass php;
		fastcgi_index index.php;
		fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
	}

}
